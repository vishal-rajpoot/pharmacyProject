import React, { useEffect, useContext, useState } from "react";
import Sidebar from "../sidebar/Sidebar";
import "./Appointment.css";
import { Link } from "react-router-dom";
import { useNavigate } from "react-router-dom";
import { Globaldata } from "../../App";

let headersList = {
  Accept: "application/json",
  "Content-Type": "application/json",
  "X-Parse-Application-Id": process.env.REACT_APP_XPARSE_APPLICATION_ID,
  "X-Parse-REST-API-Key": process.env.REACT_APP_XPARSE_REST_API_KEY,
};

function Appointment() {
  const [appointmentData, setAppointmentData] = useState([]);
  const [showModal, setShowModal] = useState(false);

  // console.log(appointmentData);
  const getAppointmentData = async () => {
    let result = await fetch(
      `${process.env.REACT_APP_REST_URL}/classes/appointment/?include=patient,doctor`,
      {
        method: "GET",
        headers: headersList,
      }
    );
    result = await result.json();
    setAppointmentData(result.results);
  };

  useEffect(() => {
    getAppointmentData();
  }, []);

  const handleDelete = async (objectId) => {
    let result = await fetch(
      `${process.env.REACT_APP_REST_URL}/classes/appointment/${objectId}?include=patient,doctor`,
      {
        method: "DELETE",
        headers: headersList,
      }
    );6
    result = await result.json();
    getAppointmentData();
  }

  const navigate = useNavigate();
  const { isUserLogin } = useContext(Globaldata);
  useEffect(() => {
    if (!isUserLogin()) {
      navigate("/");
    }
  }, []);
  return (
    <>
      <div className="flex ml-[21rem]">
        <p className="text-xl  text-[#082161] mt-20 font-[700]">Appointment</p>
      </div>
      <div className="flex ml-[2rem]">
        <p className="text text-xl  ml-[19rem] text-[#082161] font-[500] my-5">
          All Appointments
        </p>
        <input
          type="text"
          className="form-control ml-[2rem] block px-4 h-[2.5rem] w-[12rem] p-1 mt-[1rem]  text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded-md  transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none drop-shadow-md"
          placeholder="search here..."
        />
      </div>
      <div>
        <div className="flex   ml-[21rem]">
          <table className="table-auto  w-[58rem] h-[22rem]">
            <thead className="bg-[#D9D9D9]">
              <tr className="h-[2.5rem]">
                <th>
                  <input type="checkbox" />
                </th>
                <th>Patient Name</th>
                <th>Assigned Doctor</th>
                <th>Date</th>
                {/* <th>Complaints</th> */}
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {appointmentData?.map((item, index) => {
                return (
                  // <>
                  <tr className="text-center" key={item.objectId}>
                    <td>
                      <input type="checkbox" />
                    </td>
                    <td>
                      <span className="absolute ml-[-28px]">
                        <img src="https://lmsimages.sgp1.digitaloceanspaces.com/user_img.png" />
                      </span>
                      <span>{item?.patient?.first_name}</span>
                    </td>
                    <td>{item?.doctor?.full_name}</td>
                    <td>{item?.appoint_date?.iso}</td>
                    <td className="relative">
                      <svg
                        width="85"
                        height="21"
                        viewBox="0 0 85 21"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        className=" absolute ml-[15px] mt-[-10px]"
                      >
                        <rect
                          x="0.5"
                          y="0.5"
                          width="84"
                          height="20"
                          rx="2.5"
                          fill="#FC0D0D"
                          fillOpacity="0.08"
                          stroke="#FC0D0D"
                        />
                        <path
                          d="M28.134 13.224C28.198 13.224 28.254 13.25 28.302 13.302L28.764 13.8C28.412 14.208 27.984 14.526 27.48 14.754C26.98 14.982 26.374 15.096 25.662 15.096C25.046 15.096 24.486 14.99 23.982 14.778C23.478 14.562 23.048 14.262 22.692 13.878C22.336 13.49 22.06 13.026 21.864 12.486C21.668 11.946 21.57 11.352 21.57 10.704C21.57 10.056 21.672 9.462 21.876 8.922C22.08 8.382 22.366 7.918 22.734 7.53C23.106 7.142 23.55 6.842 24.066 6.63C24.582 6.414 25.152 6.306 25.776 6.306C26.388 6.306 26.928 6.404 27.396 6.6C27.864 6.796 28.276 7.062 28.632 7.398L28.248 7.932C28.224 7.972 28.192 8.006 28.152 8.034C28.116 8.058 28.066 8.07 28.002 8.07C27.93 8.07 27.842 8.032 27.738 7.956C27.634 7.876 27.498 7.788 27.33 7.692C27.162 7.596 26.952 7.51 26.7 7.434C26.448 7.354 26.138 7.314 25.77 7.314C25.326 7.314 24.92 7.392 24.552 7.548C24.184 7.7 23.866 7.922 23.598 8.214C23.334 8.506 23.128 8.862 22.98 9.282C22.832 9.702 22.758 10.176 22.758 10.704C22.758 11.24 22.834 11.718 22.986 12.138C23.142 12.558 23.352 12.914 23.616 13.206C23.884 13.494 24.198 13.714 24.558 13.866C24.922 14.018 25.314 14.094 25.734 14.094C25.99 14.094 26.22 14.08 26.424 14.052C26.632 14.02 26.822 13.972 26.994 13.908C27.17 13.844 27.332 13.764 27.48 13.668C27.632 13.568 27.782 13.45 27.93 13.314C27.998 13.254 28.066 13.224 28.134 13.224ZM33.1556 12.264C32.6636 12.28 32.2436 12.32 31.8956 12.384C31.5516 12.444 31.2696 12.524 31.0496 12.624C30.8336 12.724 30.6756 12.842 30.5756 12.978C30.4796 13.114 30.4316 13.266 30.4316 13.434C30.4316 13.594 30.4576 13.732 30.5096 13.848C30.5616 13.964 30.6316 14.06 30.7196 14.136C30.8116 14.208 30.9176 14.262 31.0376 14.298C31.1616 14.33 31.2936 14.346 31.4336 14.346C31.6216 14.346 31.7936 14.328 31.9496 14.292C32.1056 14.252 32.2516 14.196 32.3876 14.124C32.5276 14.052 32.6596 13.966 32.7836 13.866C32.9116 13.766 33.0356 13.652 33.1556 13.524V12.264ZM29.7056 9.78C30.0416 9.456 30.4036 9.214 30.7916 9.054C31.1796 8.894 31.6096 8.814 32.0816 8.814C32.4216 8.814 32.7236 8.87 32.9876 8.982C33.2516 9.094 33.4736 9.25 33.6536 9.45C33.8336 9.65 33.9696 9.892 34.0616 10.176C34.1536 10.46 34.1996 10.772 34.1996 11.112V15H33.7256C33.6216 15 33.5416 14.984 33.4856 14.952C33.4296 14.916 33.3856 14.848 33.3536 14.748L33.2336 14.172C33.0736 14.32 32.9176 14.452 32.7656 14.568C32.6136 14.68 32.4536 14.776 32.2856 14.856C32.1176 14.932 31.9376 14.99 31.7456 15.03C31.5576 15.074 31.3476 15.096 31.1156 15.096C30.8796 15.096 30.6576 15.064 30.4496 15C30.2416 14.932 30.0596 14.832 29.9036 14.7C29.7516 14.568 29.6296 14.402 29.5376 14.202C29.4496 13.998 29.4056 13.758 29.4056 13.482C29.4056 13.242 29.4716 13.012 29.6036 12.792C29.7356 12.568 29.9496 12.37 30.2456 12.198C30.5416 12.026 30.9276 11.886 31.4036 11.778C31.8796 11.666 32.4636 11.602 33.1556 11.586V11.112C33.1556 10.64 33.0536 10.284 32.8496 10.044C32.6456 9.8 32.3476 9.678 31.9556 9.678C31.6916 9.678 31.4696 9.712 31.2896 9.78C31.1136 9.844 30.9596 9.918 30.8276 10.002C30.6996 10.082 30.5876 10.156 30.4916 10.224C30.3996 10.288 30.3076 10.32 30.2156 10.32C30.1436 10.32 30.0816 10.302 30.0296 10.266C29.9776 10.226 29.9336 10.178 29.8976 10.122L29.7056 9.78ZM36.8345 9.804C36.9665 9.656 37.1065 9.522 37.2545 9.402C37.4025 9.282 37.5585 9.18 37.7225 9.096C37.8905 9.008 38.0665 8.942 38.2505 8.898C38.4385 8.85 38.6405 8.826 38.8565 8.826C39.1885 8.826 39.4805 8.882 39.7325 8.994C39.9885 9.102 40.2005 9.258 40.3685 9.462C40.5405 9.662 40.6705 9.904 40.7585 10.188C40.8465 10.472 40.8905 10.786 40.8905 11.13V15H39.8165V11.13C39.8165 10.67 39.7105 10.314 39.4985 10.062C39.2905 9.806 38.9725 9.678 38.5445 9.678C38.2285 9.678 37.9325 9.754 37.6565 9.906C37.3845 10.058 37.1325 10.264 36.9005 10.524V15H35.8265V8.922H36.4685C36.6205 8.922 36.7145 8.996 36.7505 9.144L36.8345 9.804ZM46.7479 10.002C46.7159 10.046 46.6839 10.08 46.6519 10.104C46.6199 10.128 46.5759 10.14 46.5199 10.14C46.4599 10.14 46.3939 10.116 46.3219 10.068C46.2499 10.016 46.1599 9.96 46.0519 9.9C45.9479 9.84 45.8179 9.786 45.6619 9.738C45.5099 9.686 45.3219 9.66 45.0979 9.66C44.7979 9.66 44.5339 9.714 44.3059 9.822C44.0779 9.926 43.8859 10.078 43.7299 10.278C43.5779 10.478 43.4619 10.72 43.3819 11.004C43.3059 11.288 43.2679 11.606 43.2679 11.958C43.2679 12.326 43.3099 12.654 43.3939 12.942C43.4779 13.226 43.5959 13.466 43.7479 13.662C43.9039 13.854 44.0899 14.002 44.3059 14.106C44.5259 14.206 44.7719 14.256 45.0439 14.256C45.3039 14.256 45.5179 14.226 45.6859 14.166C45.8539 14.102 45.9919 14.032 46.0999 13.956C46.2119 13.88 46.3039 13.812 46.3759 13.752C46.4519 13.688 46.5259 13.656 46.5979 13.656C46.6859 13.656 46.7539 13.69 46.8019 13.758L47.1019 14.148C46.9699 14.312 46.8199 14.452 46.6519 14.568C46.4839 14.684 46.3019 14.782 46.1059 14.862C45.9139 14.938 45.7119 14.994 45.4999 15.03C45.2879 15.066 45.0719 15.084 44.8519 15.084C44.4719 15.084 44.1179 15.014 43.7899 14.874C43.4659 14.734 43.1839 14.532 42.9439 14.268C42.7039 14 42.5159 13.672 42.3799 13.284C42.2439 12.896 42.1759 12.454 42.1759 11.958C42.1759 11.506 42.2379 11.088 42.3619 10.704C42.4899 10.32 42.6739 9.99 42.9139 9.714C43.1579 9.434 43.4559 9.216 43.8079 9.06C44.1639 8.904 44.5719 8.826 45.0319 8.826C45.4599 8.826 45.8359 8.896 46.1599 9.036C46.4879 9.172 46.7779 9.366 47.0299 9.618L46.7479 10.002ZM52.2109 11.298C52.2109 11.05 52.1749 10.824 52.1029 10.62C52.0349 10.412 51.9329 10.234 51.7969 10.086C51.6649 9.934 51.5029 9.818 51.3109 9.738C51.1189 9.654 50.9009 9.612 50.6569 9.612C50.1449 9.612 49.7389 9.762 49.4389 10.062C49.1429 10.358 48.9589 10.77 48.8869 11.298H52.2109ZM53.0749 14.148C52.9429 14.308 52.7849 14.448 52.6009 14.568C52.4169 14.684 52.2189 14.78 52.0069 14.856C51.7989 14.932 51.5829 14.988 51.3589 15.024C51.1349 15.064 50.9129 15.084 50.6929 15.084C50.2729 15.084 49.8849 15.014 49.5289 14.874C49.1769 14.73 48.8709 14.522 48.6109 14.25C48.3549 13.974 48.1549 13.634 48.0109 13.23C47.8669 12.826 47.7949 12.362 47.7949 11.838C47.7949 11.414 47.8589 11.018 47.9869 10.65C48.1189 10.282 48.3069 9.964 48.5509 9.696C48.7949 9.424 49.0929 9.212 49.4449 9.06C49.7969 8.904 50.1929 8.826 50.6329 8.826C50.9969 8.826 51.3329 8.888 51.6409 9.012C51.9529 9.132 52.2209 9.308 52.4449 9.54C52.6729 9.768 52.8509 10.052 52.9789 10.392C53.1069 10.728 53.1709 11.112 53.1709 11.544C53.1709 11.712 53.1529 11.824 53.1169 11.88C53.0809 11.936 53.0129 11.964 52.9129 11.964H48.8509C48.8629 12.348 48.9149 12.682 49.0069 12.966C49.1029 13.25 49.2349 13.488 49.4029 13.68C49.5709 13.868 49.7709 14.01 50.0029 14.106C50.2349 14.198 50.4949 14.244 50.7829 14.244C51.0509 14.244 51.2809 14.214 51.4729 14.154C51.6689 14.09 51.8369 14.022 51.9769 13.95C52.1169 13.878 52.2329 13.812 52.3249 13.752C52.4209 13.688 52.5029 13.656 52.5709 13.656C52.6589 13.656 52.7269 13.69 52.7749 13.758L53.0749 14.148ZM55.5867 6.162V15H54.5187V6.162H55.5867Z"
                          fill="#FC0D0D"
                        />
                        {/* {item.status} */}
                      </svg>
                    </td>

                    <div className="flex justify-center mt-3">
                      <Link to={`/editappointment/${item.objectId}`}>
                        <div className="tooltip" data-tip="Edit">
                          <svg
                            className="ml-3" width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0 16.327C0.4726 14.7052 0.9435 13.0835 1.4161 11.4617C1.4535 11.3325 1.4926 11.2033 1.5266 11.0741C1.581 10.8786 1.683 10.7205 1.8394 10.5896C1.9856 10.4689 2.1148 10.3244 2.2491 10.1901C4.4642 7.99536 6.6793 5.80067 8.8927 3.60427C8.9437 3.55328 8.9879 3.49548 9.0236 3.45128C9.3245 3.75387 9.6067 4.03777 9.9212 4.35397C9.8872 4.37777 9.8209 4.41177 9.7699 4.46277C7.4749 6.75267 5.1816 9.04256 2.8917 11.3376C2.8101 11.4209 2.7421 11.5348 2.7098 11.647C2.4344 12.5565 2.1726 13.471 1.9006 14.3839C1.8666 14.4978 1.8836 14.5692 1.9703 14.6474C2.1114 14.7749 2.2355 14.9211 2.3783 15.0469C2.4276 15.0894 2.5211 15.1217 2.5806 15.1064C3.4952 14.8446 4.4081 14.5777 5.3193 14.3023C5.3975 14.2785 5.4706 14.2122 5.5318 14.1493C7.8591 11.8289 10.183 9.50496 12.5069 7.18277C12.5511 7.13857 12.5885 7.08927 12.614 7.06037C12.9438 7.39017 13.2634 7.70976 13.6136 8.05996C13.5983 8.07016 13.5371 8.09566 13.4946 8.13816C11.203 10.4077 8.908 12.6721 6.6283 14.9534C6.3104 15.273 5.9653 15.4702 5.5386 15.5909C4.0256 16.0193 2.5194 16.4715 1.0098 16.9152C0.9095 16.9441 0.8075 16.9713 0.7072 17.0002H0.5712C0.4981 16.9679 0.4233 16.939 0.3502 16.905C0.1462 16.8098 0.0765 16.616 0 16.4273V16.327ZM4.5713 13.5102C4.5271 13.228 4.4795 12.9696 4.4489 12.7112C4.4336 12.5888 4.3843 12.5395 4.2653 12.5174C3.9746 12.4613 3.6873 12.3882 3.4187 12.3287C5.8293 9.91296 8.2399 7.49557 10.6352 5.09347C11.0177 5.47597 11.4172 5.87377 11.8031 6.25797C9.4163 8.65156 7.0074 11.0673 4.5713 13.5102ZM11.5141 1.08998C11.7317 0.877482 11.9493 0.651382 12.1822 0.440583C12.8503 -0.161216 13.7207 -0.147616 14.3718 0.488183C15.0909 1.18858 15.7998 1.89748 16.5002 2.61658C17.1632 3.29488 17.153 4.20267 16.4917 4.87927C16.2928 5.08327 16.0871 5.28217 15.8967 5.46917C14.4415 4.01567 12.988 2.56388 11.5141 1.08998V1.08998ZM9.741 2.69478C10.0708 2.38538 10.4091 2.06748 10.7304 1.76488C12.2536 3.28808 13.7683 4.80447 15.2966 6.33277C14.9787 6.63027 14.637 6.95157 14.3072 7.26097L9.741 2.69478Z" fill="#80ECB8" />
                          </svg>
                        </div>
                      </Link>
                      <div className="tooltip ml-5 mr-5" data-tip="Delete">
                        <label onClick={() => handleDelete(item.objectId)} htmlFor="my-modal">
                          <svg className="" width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M2.25948 14.2201C2.27648 14.6213 2.60628 14.9375 3.00748 14.9375H9.99618C10.3974 14.9375 10.7289 14.6213 10.7442 14.2201L11.244 3.6835H1.75968L2.25948 14.2201ZM8.08198 6.3015C8.08198 6.1332 8.21798 5.9972 8.38628 5.9972H8.87248C9.04078 5.9972 9.17678 6.1349 9.17678 6.3015V12.3212C9.17678 12.4895 9.03908 12.6255 8.87248 12.6255H8.38628C8.21798 12.6255 8.08198 12.4895 8.08198 12.3212V6.3015ZM5.95528 6.3015C5.95528 6.1332 6.09128 5.9972 6.25958 5.9972H6.74578C6.91408 5.9972 7.05009 6.1349 7.05009 6.3015V12.3212C7.05009 12.4895 6.91408 12.6255 6.74578 12.6255H6.25958C6.09128 12.6255 5.95528 12.4895 5.95528 12.3212V6.3015ZM3.82688 6.3015C3.82688 6.1332 3.96288 5.9972 4.12948 5.9972H4.61568C4.78398 5.9972 4.91998 6.1349 4.91998 6.3015V12.3212C4.91998 12.4895 4.78228 12.6255 4.61568 12.6255H4.12948C3.96118 12.6255 3.82688 12.4895 3.82688 12.3212V6.3015ZM11.5755 0.8292H8.35228V0.2189C8.35228 0.1322 8.28258 0.0625 8.19588 0.0625H4.80948C4.72278 0.0625 4.65308 0.1322 4.65308 0.2189V0.8292H1.42818C1.16978 0.8292 0.958984 1.0383 0.958984 1.2984V2.774H12.0447V1.2984C12.0447 1.04 11.8356 0.8292 11.5755 0.8292Z"
                              fill="#FF6760"
                            />
                          </svg>
                        </label>
                      </div>
                      <div
                        className="hover:shadow-lg mr-1 mb-1 transition-all duration-150"
                        onClick={() => setShowModal(true)}
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          height="20px"
                          viewBox="0 0 24 24"
                          width="24px"
                          fill="#000000"
                        >
                          <path d="M0 0h24v24H0z" fill="none" />
                          <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" />
                        </svg>
                      </div>
                      {showModal ? (
                        <>
                          <div className="justify-center items-center flex overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none">
                            <div className="relative w-auto my-2 mx-auto max-w-3xl">
                              <div className="border-0 rounded-lg shadow-lg relative flex flex-col w-full bg-white outline-none focus:outline-none">
                                <div className="flex items-start justify-between p-5 border-b border-solid border-slate-200 rounded-t">
                                  <h3 className="text-3xl font-semibold">
                                    Complaints / Notes
                                  </h3>
                                  <button
                                    className="p-1 ml-auto bg-transparent border-0 text-black opacity-5 float-right text-3xl leading-none font-semibold outline-none focus:outline-none"
                                    onClick={() => setShowModal(false)}
                                  >
                                    <span className="bg-transparent text-black opacity-5 h-6 w-6 text-2xl block outline-none focus:outline-none">
                                      ×
                                    </span>
                                  </button>
                                </div>
                                <div className="relative p-6 flex-auto">
                                  <p className="my-4 text-slate-500 text-lg leading-relaxed">
                                    {item.complaints}
                                  </p>
                                </div>
                                <div className="flex items-center justify-end p-6 border-t border-solid border-slate-200 rounded-b">
                                  <button
                                    className="text-red-500 background-transparent font-bold uppercase px-6 py-2 text-sm outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150"
                                    type="button"
                                    onClick={() => { setShowModal(false) }}
                                  >
                                    Close
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </>
                      ) : null}
                      {/* </> */}
                    </div>
                  </tr>
                  // </>
                );
              })}
            </tbody>
          </table>
        </div>
        <div className="flex justify-end mr-24 mt-5">
          <button className="btn btn-outline text-[#082161] capitalize btn-sm mr-[0.5rem]">
            Previous
          </button>
          <button className="btn btn-outline bg-[#082161] text-white btn-sm mr-[0.5rem]">
            1
          </button>
          <button className="btn btn-outline btn-sm mr-[0.5rem]">2</button>
          <button className="btn btn-outline text-[#082161] capitalize btn-sm mr-[0.5rem]">
            Next
          </button>
        </div>
      </div>
    </>
  );
}

export default Appointment;
